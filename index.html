<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Nuctools by homeveg</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Nuctools</h1>
      <h2 class="project-tagline">Software for analysis of chromatin feature occupancy profiles from high-throughput sequencing data</h2>
      <a href="https://github.com/homeveg/nuctools" class="btn">View on GitHub</a>
      <a href="https://github.com/homeveg/nuctools/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/homeveg/nuctools/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="nuctools" class="anchor" href="#nuctools" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>NucTools</h1>

<h2>
<a id="nuctools-is-a-software-package-for-analysis-of-chromatin-feature-occupancy-profiles-from-high-throughput-sequencing-data" class="anchor" href="#nuctools-is-a-software-package-for-analysis-of-chromatin-feature-occupancy-profiles-from-high-throughput-sequencing-data" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>NucTools is a software package for analysis of chromatin feature occupancy profiles from high-throughput sequencing data</h2>

<p>Recent advancements in high-throughput sequencing methods create a vast amount of data in which numerous chromatin features are mapped along the genome. The results are frequently analysed by creating binarized data sets that link the presence/absence of a given readout to specific genomic loci. It is currently a challenge in the field to cope with continuous distributions of deep sequencing chromatin readouts, and to integrate the different types of datasets to reveal linkages between them. Here we introduce the NucTools suite of Perl scripts and a stand-alone visualisation program for a nucleosome-centred downstream analysis of deep sequencing data. NucTools accounts for the continuous distribution of nucleosome occupancy. Furthermore, it is useful to associate nucleosome occupancy with other chromatin features like transcription factor binding, histone modifications or DNA methylation.</p>

<hr>

<h2>
<a id="system-requirement" class="anchor" href="#system-requirement" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>SYSTEM REQUIREMENT</h2>

<p>Linux (2.6 kernel or later) or Mac (OSX 10.6 Snow Leopard or later) operating system
with minimal 16 GB of RAM is recommended*. Perl v5.8 or above is required.</p>

<p>The C/C++ compiling enviroment might be required for installing dependencies, such as bedtools. Systems may vary.
Please assure that your system has the essential software building packages (e.g. build-essential
for Fedora, XCODE for Mac...etc) installed properly before running the installing 
script.</p>

<p>NucTools was tested successfully on our Linux servers (CentOS release 6.7 w/ Perl v5.10.1; 
Fedora release 22 w/ Perl v5.20.3) and Macbook Pro laptops (MAC OSX 10.11 w/ XCODE v5.1).</p>

<p>*Memory requirments depends on the experimental system. For big genomes performance will increase greatly on machines with more memory. For example, processing of 22 mouse chromosomes, with the sequencing library size about 75 000 000 reads occupy at peak load around 60-70 Gb of RAM. Important to mention, the performance is very dependent on HDD read-write speed. Therefore the parallel running of many samples at once recomended only on the server-like system or computational clusters with RAID arrays, allowing real multithreaded read-write access to HDDs array.</p>

<hr>

<h2>
<a id="quick-start" class="anchor" href="#quick-start" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>QUICK START</h2>

<p>This is an example of profiling a "test.bed" file using NucTools. The testing BED file comes along with the NucTools package
in the "test" directory. More details are stated in the INSTRUCTION section.</p>

<ol>
<li><p>Obtaining NucTools package:
    $ git clone <a href="https://github.com/homeveg/nuctools.git">https://github.com/homeveg/nuctools.git</a> NucTools</p></li>
<li><p>Installing NucTools:
    the NucTools package does not require installation. It is a collection of individual Perl scripts which can be executed individually.</p></li>
<li><p>Generate a genome annotation table using provided R script:
    $ Rscript misc/LoadAnnotation.BioMart.R</p></li>
<li>
<p>Prepare BED files from BAM files with external application (optionally) </p>

<ol>
<li>
<p>merge multiple replicates to one BAM file and sort by reads name:</p>

<p>$ samtools merge -n /Path_to_folder_with/BAM/test_sorted.bam /Path_to_folder_with/BAM/test.rp1.bam /Path_to_folder_with/BAM/test.rp2.bam /Path_to_folder_with/BAM/test.rp3.bam</p>
</li>
<li>
<p>converted sorted BAM file to BED using bowtie2bed.pl script or with external app bedtools:</p>

<p>$ perl -w bowtie2bed.pl -i /Path_to_folder_with/BAM/test_sorted.bam -verbose &gt; /Path_to_folder_with/BED/test_sorted.bed.gz</p>

<p>$ bedtools bamtobed -i /Path_to_folder_with/BAM/test_sorted.bam | pigz &gt; /Path_to_folder_with/BED/test_sorted.bed.gz</p>
</li>
</ol>
</li>
<li>
<p>Running NucTools:</p>

<ol>
<li>
<p>Extend single-end reads to the average DNA fragment size</p>

<p>$ extend_SE_reads.pl -in test.bed -out test.ext.bed.gz -fL 147</p>
</li>
<li>
<p>Extract individual chromosomes from whole genome BED</p>

<p>$ extract_chr_bed.pl -in test.ext.bed.gz -out test -d /Path_to_folder_with/BED/ -p chr </p>
</li>
<li>
<p>Convert all BED files to occupancy OCC files averaging nucleosomes occupancy values over the window of size 10</p>

<p>$ bed2occupancy_average.pl -in /Path_to_folder_with/BED/ -odir /Path_to_folder_with/OCC -dir -use -w 10</p>
</li>
<li>
<p>Calculate aggregate profiles and aligned occupancy matrices for each chromosome individually</p>

<p>$ aggregate_profile.pl -reg genome_annotation.tab -idC 0 -chrC 4 --strC 7 -sC 8 -eC 9 -pbN -lsN -lS  -chr 1 -al /Path_to_folder_with/OCC/chr1.test.occ_matrix -av /Path_to_folder_with/OCC/chr1.test.aggregate -in /Path_to_folder_with/OCC/chr1.test.w10.occ.gz -upD 1000 -downD 1000</p>
</li>
<li>
<p>Paste together aggregate profiles of each chromosome in one file and add a header</p>

<ul>
<li>Generate a header</li>
</ul>

<p>$ ls /Path_to_folder_with/OCC/<em>1000_1000.txt | perl -n -e 'if(/.</em>(chr.<em>).test.</em>/gm) { print $1, "\t"; }' | perl -n -e 'if( /(.*)\t$/g )  { print $1}' &gt; /Path_to_folder_with/OCC/test.all.occ.txt
$ echo "" &gt;&gt; /Path_to_folder_with/OCC/test.all.occ.txt</p>

<ul>
<li>paste all aggregate profiles to one file</li>
</ul>

<p>$ paste /Path_to_folder_with/OCC/*1000_1000.txt &gt;&gt; /Path_to_folder_with/OCC/test.all.occ.txt</p>
</li>
</ol>
</li>
<li><p>Optionally: 
Visualize aggregate profiles and run K-mean cluster analysis on aligned occupancy matrixes with the MatLab-based ClusterMaps Building Tool (provided as a part of NucTools package). 
<a href="https://github.com/homeveg/nuctools/raw/master/CMB/ClusterMaps_Builder_src.zip">Download link</a></p></li>
</ol>

<hr>

<h3>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h3>

<p>the NucTools suite for a nucleosome-centred downstream analysis of deep sequencing data is primarily Perl-based, and require at least Perl v5.8 with dependencies installed properly (listed in README_FULL.md).
A visualisation program is written on MatLab and requires either full MatLab insatllation or can be provided as a standolone application with web-installer compiled for MacOS X 10.9 or later.
NucTools utilize whole genome <a href="https://genome.ucsc.edu/FAQ/FAQformat#format1">BED</a> files.</p>

<p><strong>Optional external applications:</strong></p>

<ul>
<li>
<a href="http://samtools.sourceforge.net/">SamTools</a> - merge, sort and convert BAM files</li>
<li>
<a href="http://bedtools.readthedocs.io/en/latest/index.html">bedtools</a> - convert BAM to BED</li>
<li>
<a href="http://zlib.net/pigz/">PIGZ</a> - a parallel implementation of gzip for modern multi-processor, multi-core machines</li>
</ul>

<hr>

<h3>
<a id="running-nuctools" class="anchor" href="#running-nuctools" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Running NucTools</h3>

<p>One can divide the NucTools pipeline to 3 major steps: (1) prepare input OCC files (2) calculate aggregate profiles and alligned occupancy matrixes (3) followup analysis and results visualization. 
For the moment we don't have a wrapper to run all 3 steps automatically so, each step should be executed separately and, in turn, consists of several intermediate steps.</p>

<p>We will provide a testing BAM file, command line bash file, and example output in ./test. Below is a set of commands that runs "test.bam" through NucTools pipeline:</p>

<pre><code>    $ samtools sort -n ./test/test_sorted.bam ./test/test.bam
    $ bowtie2bed.pl -i ./test/test_sorted.bam --verbose &gt; ./test/test_sorted.bed.gz
    $ extend_SE_reads.pl -in ./test/test.bed -out ./test/test.ext.bed.gz
    $ extract_chr_bed.pl -in ./test/test.ext.bed.gz -out test/BED -d ./test -p chr 
    $ bed2occupancy_average.pl -in ./test/BED -odir ./test/OCC -dir -use -w 10
    $ aggregate_profile.pl -reg genome_annotation.txt -idC 0 -chrC 4 -strC 7 -sC 8 -eC 9 -pbN -lsN -lS 75000000 -chr 1 -al ./test/OCC/chr1.test.occ_matrix -av ./test/OCC/chr1.test.aggregate -in ./test/OCC/chr1.test.w10.occ.gz -upD 1000 -downD 1000
</code></pre>

<p>In the example above test.bam file is sorted by the reads names and converted to test_sorted.bed.gz file. As long as in the example case we are dealing with single-end ilumina sequencing reads, with expected read length of 100, we extending each read to the length of 100 using extend_SE_reads.pl. Resulting whole genome BED file is splitted to chromosomes with extract_chr_bed.pl script and all per-chromosome bed files are converted to OCC files with bed2occupancy_average.pl, using running window 10 (use -w 0 for bep-base resolution). Last step is to generate an aggregate profiles using aggregate_profile.pl script </p>

<hr>

<h3>
<a id="interpreting-results" class="anchor" href="#interpreting-results" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Interpreting Results</h3>

<p>NucTools bed2occupancy_average.pl scritp generates 2 types of the output. The file containing one column of numbers, corresponding to an aggregate profile (could be visualized, for example in Excel) and the tab-delimited text file containing all occupancy data for each region of interest (or transcript), aligned at annotated strat. These matrixes can be later visualized with our ClusterMaps Building Tool.</p>

<hr>

<h2>
<a id="nuctools-scripts" class="anchor" href="#nuctools-scripts" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>NucTools scripts</h2>

<h3>
<a id="initial-data-transformation" class="anchor" href="#initial-data-transformation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Initial data transformation</h3>

<ul>
<li>
<h3>
<a id="bowtie2bedpl" class="anchor" href="#bowtie2bedpl" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>bowtie2bed.pl</h3>

<p>takes as an input standard SAM, BAM or MAP file and converts to the gzip-compressed BED file. The programm require samtools installed in PATH to be able to work with BAM files</p>

<pre><code>$ perl -w bowtie2bed.pl --input=accepte_hits.bam --output=sample.bed.gz [--verbose --help]
</code></pre>
</li>
<li>
<h3>
<a id="extend_se_readspl" class="anchor" href="#extend_se_readspl" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>extend_SE_reads.pl</h3>

<p>Extends single-end reads by the user-defined value of the average DNA fragment length. Script works with compressed or uncompressed BED files and save output as compress *.BED.GZ</p>

<pre><code>$ perl -w extend_SE_reads.pl -in &lt;in.bed&gt; -out &lt;out.bed&gt; -fL &lt;fragment length&gt; \
[-cC &lt;column Nr.&gt; -sC &lt;column Nr.&gt; -eC &lt;column Nr.&gt; -strC &lt;column Nr.&gt; ] [--help] 
</code></pre>
</li>
<li>
<h3>
<a id="extend_pe_readspl" class="anchor" href="#extend_pe_readspl" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>extend_PE_reads.pl</h3>

<p>Takes as an input BED file with mapped paired-end reads (two lines per paired read) sorted according to the read name and reformat it by creating a smaller BED file with one line per nucleosome in the following format: (1) chromosome, (2) nucleosome start, (3) nucleosome end, (4) nucleosome length</p>

<pre><code>$ perl -w extend_PE_reads.pl -in &lt;in.bed&gt; -out &lt;out.bed&gt; [--help] 
</code></pre>
</li>
<li>
<h3>
<a id="extract_chr_bedpl" class="anchor" href="#extract_chr_bedpl" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>extract_chr_bed.pl</h3>

<p>Splits whole genome BED file with mapped reads into smaller BED files per each chromosome</p>

<pre><code>$ perl -w extract_chr_bed.pl -in all_data.bed.gz -out output_name_template -p [&lt;pattern&gt;] [--help] 
</code></pre>
</li>
<li>
<h3>
<a id="bed2occupancy_averagepl" class="anchor" href="#bed2occupancy_averagepl" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>bed2occupancy_average.pl</h3>

<p>Calculates genome-wide nucleosome occupancy, based on the BED file with sequencing reads. It converts BED files for all or specified chromosomes. The running window occupancy file (*.OCC) is a text file containing normalized reads frequency distribution along each chromosome in the running window.</p>

<pre><code>$ perl -w bed2occupancy_average.pl --input=&lt;in.bed.gz&gt; --output=&lt;out.occ.gz&gt; \
[--outdir=&lt;DIR_WITH_OCC&gt; --chromosome_col=&lt;column Nr.&gt; --start_col=&lt;column Nr.&gt; --end_col=&lt;column Nr.&gt; \
--strand_col=&lt;column Nr.&gt; --window=&lt;running window size&gt; --consider_strand --ConvertAllInDir --help]
</code></pre>
</li>
</ul>

<h3>
<a id="core-scripts" class="anchor" href="#core-scripts" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Core scripts</h3>

<ul>
<li>
<h3>
<a id="aggregate_profilepl" class="anchor" href="#aggregate_profilepl" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>aggregate_profile.pl</h3>

<p>Calculates aggregate profile of sequencing read density around genomic regions. As an input it utilze a tab-delimited text file or BED file with coordinates of genomic features (promoters, enhancers, chromatin domains, TF binding sites, etc), and the OCC files with continuous chromosome-wide occupancy (nucleosome occupancy, TF distribution, etc). Calculates normalized occupancy profiles for each of the features, as well as the aggregate profile representing the average occupancy centred at the middle of the feature</p>

<pre><code>$ perl -w aggregate_profile.pl --input=&lt;in.occ.gz&gt; --regions=&lt;annotations.txt&gt; [--verbose --help ]
</code></pre>
</li>
<li>
<h3>
<a id="average_replicatespl" class="anchor" href="#average_replicatespl" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>average_replicates.pl</h3>

<p>Calculates the average occupancy profile and standard deviation based on several replicate occupancy profiles from the working directory and save resulting table, including input occupancy data for individual files. Input *.occ files can be flat or compressed. Resulting extended occupancy file will be saved compressed</p>

<pre><code>$ perl -w average_replicates.pl --dir=&lt;path to working dir&gt; --output=&lt;path to results file&gt; --coordsCol=0 \
--occupCol=1 --pattern="occ.gz" --printData --sum [--help]  
</code></pre>
</li>
<li>
<h3>
<a id="calc_fragment_lengthpl" class="anchor" href="#calc_fragment_lengthpl" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>calc_fragment_length.pl</h3>

<p>Estimates mean fragment length for a single-end sequencing library</p>

<pre><code>$ perl -w calc_fragment_length.pl --input=&lt;in.bed&gt; --output=&lt;filtered.txt&gt; \
[--delta=&lt;N&gt; --apply_filter --filtering_threshold=&lt;N&gt; --pile=&lt;N&gt; --fix_pile_size ] \ 
[--chromosome_col=&lt;column Nr.&gt; --start_col=&lt;column Nr.&gt; --end_col=&lt;column Nr.&gt; --strand_col=&lt;column Nr.&gt; --help]
</code></pre>
</li>
<li>
<h3>
<a id="nucleosome_repeat_lengthpl" class="anchor" href="#nucleosome_repeat_lengthpl" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>nucleosome_repeat_length.pl</h3>

<p>Calculates frequency of nucleosome-nucleosome distances to determine the nucleosome repeat length</p>

<pre><code>$ perl -w nucleosome_repeat_length.pl --input=&lt;in.bed&gt; --output=&lt;filtered.txt&gt; \
[--delta=&lt;N&gt; --apply_filter --filtering_threshold=&lt;N&gt; --pile=&lt;N&gt; --fix_pile_size ] \
[--chromosome_col=&lt;column Nr.&gt; --start_col=&lt;column Nr.&gt; --end_col=&lt;column Nr.&gt; --strand_col=&lt;column Nr.&gt; --help]
</code></pre>
</li>
<li>
<h3>
<a id="stable_nucs_replicatespl" class="anchor" href="#stable_nucs_replicatespl" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>stable_nucs_replicates.pl</h3>

<p>Finds stable and fussy nucleosomes using all replicates for the same experimental condition</p>

<pre><code>$ perl -w stable_nucs_replicates.pl --input=&lt;path to input DIR&gt; --output=&lt;out.bed&gt; --chromosome=chr1 \
[-coordsCol=0 -occupCol=2 -StableThreshold=0.5 --printData ] [--help] 
</code></pre>
</li>
</ul>

<h3>
<a id="vizualization-and-additional-scripts" class="anchor" href="#vizualization-and-additional-scripts" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Vizualization and additional scripts</h3>

<ul>
<li>
<h3>
<a id="loadannotationbiomartr" class="anchor" href="#loadannotationbiomartr" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>LoadAnnotation.BioMart.R</h3>

<p>R script to retrieve genes annotation from EnsEMBL using Bioconductor BioMart package. Genes annotation table, particulary TSS/TTS coordinates, chromosomes and strand inforamtion is used with aggregate_profile.pl as a genomic features table.</p>
</li>
<li>
<h3>
<a id="nrlloessestimationr" class="anchor" href="#nrlloessestimationr" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>NRL.loess.estimation.R</h3>

<p>Peak detection R script to estimate NRL based on nucleosome_repeat_length.pl output.</p>
</li>
<li>
<h3>
<a id="cmb---cluster-maps-builder" class="anchor" href="#cmb---cluster-maps-builder" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>CMB - Cluster Maps Builder</h3>

<p>Aggregate profile and aligned occupancy matrix visualizer. MatLab-based stand-alown GUI application, compiled to run on MacOS X</p>
</li>
</ul>

<hr>

<h2>
<a id="additional-information" class="anchor" href="#additional-information" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Additional information</h2>

<p>Additional information, publications references and short description of each script from the toolbox can be found here:</p>

<ul>
<li>
<a href="http://www.generegulation.info/index.php/nuctools">http://www.generegulation.info/index.php/nuctools</a> (external link)</li>
<li>
<a href="https://homeveg.github.io/nuctools/">https://homeveg.github.io/nuctools/</a> (GitHub pages)</li>
</ul>

<p><strong>PLEASE NOTE</strong>:
<em>we are currently preparing a manuscript and will add here more information, usage instruction and test data set soon.
The project is under development now.</em></p>

<h3>
<a id="planned-modifications" class="anchor" href="#planned-modifications" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Planned modifications</h3>

<p>There are several changes has been planned and partially implemented:</p>

<ul>
<li>implement GZIP support for all input/output files generated by the pipeline scripts</li>
<li>implement gapped OCC format support to all relevant scripts</li>
<li>extend NucTools documentation and usage examples with Perl POD package</li>
<li>unify pipeline scripts input parameters using Perl GETOPT package</li>
</ul>

<h3>
<a id="future-possible-modifications" class="anchor" href="#future-possible-modifications" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Future possible modifications</h3>

<ul>
<li>BAM files support</li>
<li>parallel processing (beautiful codes snippets for implementation of parallel processing of BAM files with Perl one can find here: <a href="https://genomebytes.wordpress.com/2013/07/24/multi-thread-access-of-bam-files-using-perl-and-samtools/">https://genomebytes.wordpress.com/2013/07/24/multi-thread-access-of-bam-files-using-perl-and-samtools/</a> )</li>
<li>NucTools automated package installation with make</li>
</ul>

<h2>
<a id="major-changes-in-porogres" class="anchor" href="#major-changes-in-porogres" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Major changes (in porogres):</h2>

<ul>
<li>GZIP support implementation - all input files can be compressed and all newly created output files saved as *.gz</li>
<li>Handle gapped occupancy files: to save space and memory remove all regions/bases with 0 counts</li>
<li>implement POD documentation (with Pod::Usage)</li>
<li>command line parametrs allow long and short options (with Getopt::Long::GetOptions)</li>
</ul>

<h3>
<a id="developers" class="anchor" href="#developers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Developers:</h3>

<p>Yevhen Vainshtein and Vladimir B. Teif</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/homeveg/nuctools">Nuctools</a> is maintained by <a href="https://github.com/homeveg">homeveg</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
